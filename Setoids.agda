{-# OPTIONS --type-in-type #-}
module Rosetta.Setoids where
open import Rosetta.Equivalence
open import Rosetta.Equality
open import Rosetta.Category        as Category
open import Rosetta.CartesianClosed as CartesianClosed
open import Rosetta.Sets            as ğ“¢et hiding (ğŸ™; _Ã—_; _â‡’_)

record Setoid : Set where
  infix 4 _âˆ£_âˆ¼_
  field
    âˆ£_âˆ£ : Set
    _âˆ£_âˆ¼_ : Rel âˆ£_âˆ£
    â¦ƒ .âˆ¼â€¿equiv â¦„ : IsEquivalence _âˆ£_âˆ¼_

open Setoid public hiding (âˆ¼â€¿equiv)

infix 0 _-ğ“¢ğ“®ğ“½âŸ¶_
record _-ğ“¢ğ“®ğ“½âŸ¶_ (ğ‘¨ ğ‘© : Setoid) : Set where
  field
    _â‚€_  : âˆ£ ğ‘¨ âˆ£ â†’ âˆ£ ğ‘© âˆ£
    ._â‚_ : âˆ€ {x y} â†’ ğ‘¨ âˆ£ x âˆ¼ y â†’ ğ‘© âˆ£ _â‚€_ x âˆ¼ _â‚€_ y

open _-ğ“¢ğ“®ğ“½âŸ¶_ public

instance
  ğ“¢ğ“®ğ“½-op : Category.Op _-ğ“¢ğ“®ğ“½âŸ¶_
  ğ“¢ğ“®ğ“½-op = record
    { id  = record
      { _â‚€_ = id
      ; _â‚_ = id
      }
    ; _âˆ˜_ = Î» ğ’ˆ ğ’‡ â†’ record
      { _â‚€_ = ğ’ˆ â‚€_ âˆ˜ ğ’‡ â‚€_
      ; _â‚_ = ğ’ˆ â‚_ âˆ˜ ğ’‡ â‚_
      }
    }

infix 4 _âˆ¼_
_âˆ¼_ : âˆ€ {ğ‘¨ ğ‘© : Setoid} â†’ Rel (ğ‘¨ -ğ“¢ğ“®ğ“½âŸ¶ ğ‘©)
_âˆ¼_ {ğ‘¨} {ğ‘©} ğ’‡ ğ’ˆ = âˆ€ {x y} â†’ ğ‘¨ âˆ£ x âˆ¼ y â†’ ğ‘© âˆ£ ğ’‡ â‚€ x âˆ¼ ğ’ˆ â‚€ y

.âˆ¼â€¿reflâ‚_â‚ : âˆ€ {ğ‘¨ ğ‘©} (ğ’‡ : ğ‘¨ -ğ“¢ğ“®ğ“½âŸ¶ ğ‘©) â†’ ğ’‡ âˆ¼ ğ’‡
.âˆ¼â€¿sym     : âˆ€ {ğ‘¨ ğ‘©} {ğ’‡ ğ’ˆ : ğ‘¨ -ğ“¢ğ“®ğ“½âŸ¶ ğ‘©} â†’ ğ’‡ âˆ¼ ğ’ˆ â†’ ğ’ˆ âˆ¼ ğ’‡
.âˆ¼â€¿trans   : âˆ€ {ğ‘¨ ğ‘©} {ğ’‡ ğ’ˆ ğ’‰ : ğ‘¨ -ğ“¢ğ“®ğ“½âŸ¶ ğ‘©} â†’ ğ’‡ âˆ¼ ğ’ˆ â†’ ğ’ˆ âˆ¼ ğ’‰ â†’ ğ’‡ âˆ¼ ğ’‰
âˆ¼â€¿reflâ‚ ğ’‡ â‚     = Î» xâˆ¼y â†’ ğ’‡ â‚ xâˆ¼y
âˆ¼â€¿sym   ğ’‡âˆ¼ğ’ˆ     = Î» xâˆ¼y â†’ sym (ğ’‡âˆ¼ğ’ˆ (sym xâˆ¼y))
âˆ¼â€¿trans ğ’‡âˆ¼ğ’ˆ ğ’ˆâˆ¼ğ’‰ = Î» xâˆ¼y â†’ trans (ğ’‡âˆ¼ğ’ˆ xâˆ¼y) (ğ’ˆâˆ¼ğ’‰ refl)

.âˆ¼â€¿injâ‚_â‚ : âˆ€ {ğ‘¨ ğ‘©} (ğ’‡ {ğ’ˆ} : ğ‘¨ -ğ“¢ğ“®ğ“½âŸ¶ ğ‘©) â†’ ğ’‡ â‰¡ ğ’ˆ â†’ ğ’‡ âˆ¼ ğ’ˆ
âˆ¼â€¿injâ‚ ğ’‡ â‚ â‰¡-refl = âˆ¼â€¿reflâ‚ ğ’‡ â‚

instance
  âˆ¼â€¿equiv : âˆ€ {ğ‘¨ ğ‘© : Setoid} â†’ IsEquivalence (_âˆ¼_ {ğ‘¨} {ğ‘©})
  âˆ¼â€¿equiv = record
    { reflâ‚_â‚ = âˆ¼â€¿reflâ‚_â‚
    ; sym     = Î» {ğ’‡} {ğ’ˆ} â†’ âˆ¼â€¿sym {ğ’‡ = ğ’‡} {ğ’ˆ}
    ; trans   = Î» {ğ’‡} {ğ’ˆ} {ğ’‰} â†’ âˆ¼â€¿trans {ğ’‡ = ğ’‡} {ğ’ˆ} {ğ’‰}
    }

ğ“¢ğ“®ğ“½ : Category
ğ“¢ğ“®ğ“½ = record
  { ob    = Setoid
  ; hom   = _-ğ“¢ğ“®ğ“½âŸ¶_
  ; _âˆ£_âˆ¼_ = _âˆ¼_
  ; âˆ˜-congâ‚‚ = Î» ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ ğ’‡â‚âˆ¼ğ’‡â‚‚ xâˆ¼y â†’ ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ (ğ’‡â‚âˆ¼ğ’‡â‚‚ xâˆ¼y)
  ; âˆ˜-unitË¡ = Î» { {f = ğ’‡} â†’ âˆ¼â€¿reflâ‚ ğ’‡ â‚ }
  ; âˆ˜-unitÊ³ = Î» { {f = ğ’‡} â†’ âˆ¼â€¿reflâ‚ ğ’‡ â‚ }
  ; âˆ˜-assoc = Î» { {f = ğ’‡} {ğ’ˆ} {ğ’‰} â†’ âˆ¼â€¿reflâ‚ ğ’‰ âˆ˜ ğ’ˆ âˆ˜ ğ’‡ â‚ }
  }

ğŸ™ : Setoid
ğŸ™ = record
  { âˆ£_âˆ£   = ğ“¢et.ğŸ™
  ; _âˆ£_âˆ¼_ = Î» _ _ â†’ ğ“¢et.ğŸ™
  ; âˆ¼â€¿equiv = record
    { reflâ‚_â‚ = Î» _   â†’ tt
    ; sym     = Î» _   â†’ tt
    ; trans   = Î» _ _ â†’ tt
    }
  }

infixr 6 _Ã—_
_Ã—_ : Setoid â†’ Setoid â†’ Setoid
ğ‘¨ Ã— ğ‘© = record
  { âˆ£_âˆ£   = âˆ£ ğ‘¨ âˆ£ ğ“¢et.Ã— âˆ£ ğ‘© âˆ£
  ; _âˆ£_âˆ¼_ = Î» { (xâ‚ , xâ‚‚) (yâ‚ , yâ‚‚) â†’ (ğ‘¨ âˆ£ xâ‚ âˆ¼ yâ‚) ğ“¢et.Ã— (ğ‘© âˆ£ xâ‚‚ âˆ¼ yâ‚‚) }
  ; âˆ¼â€¿equiv = record
    { reflâ‚_â‚ = Î» { (xâ‚ , xâ‚‚) â†’ reflâ‚ xâ‚ â‚ , reflâ‚ xâ‚‚ â‚ }
    ; sym     = Î» { (xâ‚âˆ¼yâ‚ , xâ‚‚âˆ¼yâ‚‚) â†’ sym xâ‚âˆ¼yâ‚ , sym xâ‚‚âˆ¼yâ‚‚ }
    ; trans   = Î» { (xâ‚âˆ¼yâ‚ , xâ‚‚âˆ¼yâ‚‚) (yâ‚âˆ¼zâ‚ , yâ‚‚âˆ¼zâ‚‚) â†’ trans xâ‚âˆ¼yâ‚ yâ‚âˆ¼zâ‚ , trans xâ‚‚âˆ¼yâ‚‚ yâ‚‚âˆ¼zâ‚‚ }
    }
  }

infixr 7 _â‡’_
_â‡’_ : Setoid â†’ Setoid â†’ Setoid
ğ‘¨ â‡’ ğ‘© = record
  { âˆ£_âˆ£   = ğ‘¨ -ğ“¢ğ“®ğ“½âŸ¶ ğ‘©
  ; _âˆ£_âˆ¼_ = _âˆ¼_
  }

instance
  ğ“¢ğ“®ğ“½âœ“-op : CartesianClosed.Op _-ğ“¢ğ“®ğ“½âŸ¶_
  ğ“¢ğ“®ğ“½âœ“-op = record
    { ğŸ™   = ğŸ™
    ; _Ã—_ = _Ã—_
    ; _â‡’_ = _â‡’_

    ; !     = record
      { _â‚€_ = !
      ; _â‚_ = !
      }
    ; Ï€â‚    = record
      { _â‚€_ = Ï€â‚
      ; _â‚_ = Ï€â‚
      }
    ; Ï€â‚‚    = record
      { _â‚€_ = Ï€â‚‚
      ; _â‚_ = Ï€â‚‚
      }
    ; âŸ¨_,_âŸ© = Î» ğ’‡ ğ’ˆ â†’ record
      { _â‚€_ = âŸ¨ ğ’‡ â‚€_ , ğ’ˆ â‚€_ âŸ©
      ; _â‚_ = âŸ¨ ğ’‡ â‚_ , ğ’ˆ â‚_ âŸ©
      }
    ; ev    = record
      { _â‚€_ = Î» { (ğ’‡   , x)   â†’ ğ’‡ â‚€ x }
      ; _â‚_ = Î» { (ğ’‡âˆ¼ğ’ˆ , xâˆ¼y) â†’ ğ’‡âˆ¼ğ’ˆ xâˆ¼y }
      }
    ; Î»â‚_â‚  = Î» ğ’‡ â†’ record
      { _â‚€_ = Î» x â†’ record
        { _â‚€_ = Î» y     â†’ ğ’‡ â‚€ (x    , y)
        ; _â‚_ = Î» yâ‚âˆ¼yâ‚‚ â†’ ğ’‡ â‚ (refl , yâ‚âˆ¼yâ‚‚)
        }
      ; _â‚_ = Î» xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ ğ’‡ â‚ (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
      }
    }

ğ“¢ğ“®ğ“½âœ“ : CartesianClosed ğ“¢ğ“®ğ“½
ğ“¢ğ“®ğ“½âœ“ = record
  { !-universal   = Î» { {â‡ = â‡} â†’ âˆ¼â€¿reflâ‚ â‡ â‚ }
  ; âŸ¨,âŸ©-congâ‚‚     = Î» ğ’‡â‚âˆ¼ğ’‡â‚‚ ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ xâˆ¼y â†’ ğ’‡â‚âˆ¼ğ’‡â‚‚ xâˆ¼y , ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ xâˆ¼y
  ; âŸ¨,âŸ©-commuteâ‚  = Î» { {f = ğ’‡} â†’ âˆ¼â€¿reflâ‚ ğ’‡ â‚ }
  ; âŸ¨,âŸ©-commuteâ‚‚  = Î» { {g = ğ’ˆ} â†’ âˆ¼â€¿reflâ‚ ğ’ˆ â‚ }
  ; âŸ¨,âŸ©-universal = Î» â‡-commuteâ‚ â‡-commuteâ‚‚ xâˆ¼y â†’ â‡-commuteâ‚ xâˆ¼y , â‡-commuteâ‚‚ xâˆ¼y
  ; Î»-cong        = Î» ğ’‡â‚âˆ¼ğ’‡â‚‚ xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ ğ’‡â‚âˆ¼ğ’‡â‚‚ (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
  ; Î»-commute     = Î» { {f = ğ’‡} â†’ âˆ¼â€¿reflâ‚ ğ’‡ â‚ }
  ; Î»-universal   = Î» â‡-commute xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ â‡-commute (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
  }
