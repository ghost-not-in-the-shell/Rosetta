{-# OPTIONS --type-in-type #-}
module Rosetta.Setoids where
open import Rosetta.CartesianClosed
open import Rosetta.Category
open import Rosetta.Equivalence
open import Rosetta.Prelude
open import Rosetta.Sets

record ğ“¢ğ“®ğ“½âˆ£_âŸ¶_ (ğ‘¨ ğ‘© : Setoid) : Set where
  infixr 6 _â‚€_
  infixr 6 _â‚_
  field
    _â‚€_ : âˆ£ ğ‘¨ âˆ£ â†’ âˆ£ ğ‘© âˆ£
    ._â‚_ : âˆ€ {x y} â†’ ğ‘¨ âˆ£ x âˆ¼ y â†’ ğ‘© âˆ£ _â‚€_ x âˆ¼ _â‚€_ y

open ğ“¢ğ“®ğ“½âˆ£_âŸ¶_ public

instance
  ğ“¢ğ“®ğ“½-op : Op ğ“¢ğ“®ğ“½âˆ£_âŸ¶_
  ğ“¢ğ“®ğ“½-op = record
    { id  = record
      { _â‚€_ = id
      ; _â‚_ = id
      }
    ; _âˆ˜_ = Î» ğ’ˆ ğ’‡ â†’ record
      { _â‚€_ = ğ’ˆ â‚€_ âˆ˜ ğ’‡ â‚€_
      ; _â‚_ = ğ’ˆ â‚_ âˆ˜ ğ’‡ â‚_
      }
    }

module _ {ğ‘¨ ğ‘© : Setoid} where
  infix 4 ğ“¢ğ“®ğ“½âˆ£_â‰ˆ_
  ğ“¢ğ“®ğ“½âˆ£_â‰ˆ_ : Rel (ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©)
  ğ“¢ğ“®ğ“½âˆ£ ğ’‡ â‰ˆ ğ’ˆ = âˆ€ {x y}
    â†’ ğ‘¨ âˆ£ x âˆ¼ y
    â†’ ğ‘© âˆ£ ğ’‡ â‚€ x âˆ¼ ğ’ˆ â‚€ y

  .ğ“¢ğ“®ğ“½â‰ˆ-refl  : âˆ€ {ğ’‡ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©} â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ â‰ˆ ğ’‡
  .ğ“¢ğ“®ğ“½â‰ˆ-sym   : âˆ€ {ğ’‡ ğ’ˆ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©} â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ â‰ˆ ğ’ˆ â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’ˆ â‰ˆ ğ’‡
  .ğ“¢ğ“®ğ“½â‰ˆ-trans : âˆ€ {ğ’‡ ğ’ˆ ğ’‰ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©} â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ â‰ˆ ğ’ˆ â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’ˆ â‰ˆ ğ’‰ â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ â‰ˆ ğ’‰
  ğ“¢ğ“®ğ“½â‰ˆ-refl  {ğ’‡}     = Î» xâˆ¼y â†’ ğ’‡ â‚ xâˆ¼y
  ğ“¢ğ“®ğ“½â‰ˆ-sym   ğ’‡â‰ˆğ’ˆ     = Î» xâˆ¼y â†’ sym (ğ’‡â‰ˆğ’ˆ (sym xâˆ¼y))
  ğ“¢ğ“®ğ“½â‰ˆ-trans ğ’‡â‰ˆğ’ˆ ğ’ˆâ‰ˆğ’‰ = Î» xâˆ¼y â†’ trans (ğ’‡â‰ˆğ’ˆ xâˆ¼y) (ğ’ˆâ‰ˆğ’‰ refl)

  instance
    ğ“¢ğ“®ğ“½â‰ˆ-equiv : IsEquivalence ğ“¢ğ“®ğ“½âˆ£_â‰ˆ_
    ğ“¢ğ“®ğ“½â‰ˆ-equiv = record
      { refl   = Î» {ğ’‡}     â†’ ğ“¢ğ“®ğ“½â‰ˆ-refl  {ğ’‡}
      ; sym    = Î» {ğ’‡ ğ’ˆ}   â†’ ğ“¢ğ“®ğ“½â‰ˆ-sym   {ğ’‡} {ğ’ˆ}
      ; trans  = Î» {ğ’‡ ğ’ˆ ğ’‰} â†’ ğ“¢ğ“®ğ“½â‰ˆ-trans {ğ’‡} {ğ’ˆ} {ğ’‰}
      }

  .ğ“¢ğ“®ğ“½â‰ˆ-reflâ‚_â‚ : âˆ€ (ğ’‡ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©) â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ â‰ˆ ğ’‡
  ğ“¢ğ“®ğ“½â‰ˆ-reflâ‚ ğ’‡ â‚ = ğ“¢ğ“®ğ“½â‰ˆ-refl {ğ’‡}

ğ“¢ğ“®ğ“½ : Category
ğ“¢ğ“®ğ“½ = record
  { ob  = Setoid
  ; hom = ğ“¢ğ“®ğ“½âˆ£_âŸ¶_
  ; _â‰ˆ_ = ğ“¢ğ“®ğ“½âˆ£_â‰ˆ_
  ; âˆ˜-congâ‚‚ = Î» ğ’ˆâ‚â‰ˆğ’ˆâ‚‚ ğ’‡â‚â‰ˆğ’‡â‚‚ xâˆ¼y â†’ ğ’ˆâ‚â‰ˆğ’ˆâ‚‚ (ğ’‡â‚â‰ˆğ’‡â‚‚ xâˆ¼y)
  ; âˆ˜-unitË¡ = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½â‰ˆ-reflâ‚ ğ’‡ â‚ }
  ; âˆ˜-unitÊ³ = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½â‰ˆ-reflâ‚ ğ’‡ â‚ }
  ; âˆ˜-assoc = Î» { {f = ğ’‡} {ğ’ˆ} {ğ’‰} â†’ ğ“¢ğ“®ğ“½â‰ˆ-reflâ‚ ğ’‰ âˆ˜ ğ’ˆ âˆ˜ ğ’‡ â‚ }
  }

{-# DISPLAY ğ“¢ğ“®ğ“½âˆ£_âŸ¶_ ğ‘¨ ğ‘© = ğ“¢ğ“®ğ“½ âˆ£ ğ‘¨ âŸ¶ ğ‘© #-}
{-# DISPLAY ğ“¢ğ“®ğ“½âˆ£_â‰ˆ_ ğ’‡ ğ’ˆ = ğ“¢ğ“®ğ“½ âˆ£ ğ’‡ â‰ˆ ğ’ˆ #-}

module ğ“¢ğ“®ğ“½ where
  infixr 6 _Ã—_
  infixr 7 _â‡’_

  ğŸ™ : Setoid
  ğŸ™ = record
    { âˆ£_âˆ£ = ğ“¢et.ğŸ™
    ; _âˆ¼_ = Î» _ _ â†’ ğ“¢et.ğŸ™
    ; âˆ¼-equiv = record
      { refl  =         tt
      ; sym   = Î» _   â†’ tt
      ; trans = Î» _ _ â†’ tt
      }
    }

  _Ã—_ : Setoid â†’ Setoid â†’ Setoid
  ğ‘¨ Ã— ğ‘© = record
    { âˆ£_âˆ£ = âˆ£ ğ‘¨ âˆ£ ğ“¢et.Ã— âˆ£ ğ‘© âˆ£
    ; _âˆ¼_ = Î» { (xâ‚ , xâ‚‚) (yâ‚ , yâ‚‚) â†’ (ğ‘¨ âˆ£ xâ‚ âˆ¼ yâ‚) ğ“¢et.Ã— (ğ‘© âˆ£ xâ‚‚ âˆ¼ yâ‚‚) }
    ; âˆ¼-equiv = record
      { refl  = refl , refl
      ; sym   = Î» { (xâ‚âˆ¼yâ‚ , xâ‚‚âˆ¼yâ‚‚) â†’ sym xâ‚âˆ¼yâ‚ , sym xâ‚‚âˆ¼yâ‚‚ }
      ; trans = Î» { (xâ‚âˆ¼yâ‚ , xâ‚‚âˆ¼yâ‚‚) (yâ‚âˆ¼zâ‚ , yâ‚‚âˆ¼zâ‚‚) â†’ trans xâ‚âˆ¼yâ‚ yâ‚âˆ¼zâ‚ , trans xâ‚‚âˆ¼yâ‚‚ yâ‚‚âˆ¼zâ‚‚ }
      }
    }

  _â‡’_ : Setoid â†’ Setoid â†’ Setoid
  ğ‘¨ â‡’ ğ‘© = record
    { âˆ£_âˆ£ = ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©
    ; _âˆ¼_ = ğ“¢ğ“®ğ“½âˆ£_â‰ˆ_
    }

open ğ“¢ğ“®ğ“½

instance
  ğ“¢ğ“®ğ“½-opâœ“ : Opâœ“ ğ“¢ğ“®ğ“½âˆ£_âŸ¶_
  ğ“¢ğ“®ğ“½-opâœ“ = record
    { ğŸ™   = ğŸ™
    ; _Ã—_ = _Ã—_
    ; _â‡’_ = _â‡’_
    ; !     = record
      { _â‚€_ = !
      ; _â‚_ = !
      }
    ; Ï€â‚    = record
      { _â‚€_ = Ï€â‚
      ; _â‚_ = Ï€â‚
      }
    ; Ï€â‚‚    = record
      { _â‚€_ = Ï€â‚‚
      ; _â‚_ = Ï€â‚‚
      }
    ; âŸ¨_,_âŸ© = Î» ğ’‡ ğ’ˆ â†’ record
      { _â‚€_ = âŸ¨ ğ’‡ â‚€_ , ğ’ˆ â‚€_ âŸ©
      ; _â‚_ = âŸ¨ ğ’‡ â‚_ , ğ’ˆ â‚_ âŸ©
      }
    ; Îµ     = record
      { _â‚€_ = Î» { (ğ’‡     , x)     â†’ ğ’‡ â‚€   x }
      ; _â‚_ = Î» { (ğ’‡â‚â‰ˆğ’‡â‚‚ , xâ‚âˆ¼xâ‚‚) â†’ ğ’‡â‚â‰ˆğ’‡â‚‚ xâ‚âˆ¼xâ‚‚ }
      }
    ; Æ›_    = Î» ğ’‡ â†’ record
      { _â‚€_ = Î» x â†’ record
        { _â‚€_ = Î» y     â†’ ğ’‡ â‚€ (      x   , y)
        ; _â‚_ = Î» yâ‚âˆ¼yâ‚‚ â†’ ğ’‡ â‚ (reflâ‚ x â‚ , yâ‚âˆ¼yâ‚‚)
        }
      ; _â‚_ = Î» xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ ğ’‡ â‚ (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
      }
    }

ğ“¢ğ“®ğ“½âœ“ : CartesianClosed ğ“¢ğ“®ğ“½
ğ“¢ğ“®ğ“½âœ“ = record
  { !-universal   = Î» { {â‡ = â‡} â†’ ğ“¢ğ“®ğ“½â‰ˆ-reflâ‚ â‡ â‚ }
  ; âŸ¨,âŸ©-congâ‚‚     = Î» ğ’‡â‚â‰ˆğ’‡â‚‚ ğ’ˆâ‚â‰ˆğ’ˆâ‚‚ xâˆ¼y â†’ ğ’‡â‚â‰ˆğ’‡â‚‚ xâˆ¼y , ğ’ˆâ‚â‰ˆğ’ˆâ‚‚ xâˆ¼y
  ; âŸ¨,âŸ©-commuteâ‚  = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½â‰ˆ-reflâ‚ ğ’‡ â‚ }
  ; âŸ¨,âŸ©-commuteâ‚‚  = Î» { {g = ğ’ˆ} â†’ ğ“¢ğ“®ğ“½â‰ˆ-reflâ‚ ğ’ˆ â‚ }
  ; âŸ¨,âŸ©-universal = Î» â‡-commuteâ‚ â‡-commuteâ‚‚ xâˆ¼y â†’ â‡-commuteâ‚ xâˆ¼y , â‡-commuteâ‚‚ xâˆ¼y
  ; Æ›-cong        = Î» ğ’‡â‚â‰ˆğ’‡â‚‚ xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ ğ’‡â‚â‰ˆğ’‡â‚‚ (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
  ; Æ›-commute     = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½â‰ˆ-reflâ‚ ğ’‡ â‚ }
  ; Æ›-universal   = Î» â‡-commute xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ â‡-commute (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
  }
