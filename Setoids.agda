{-# OPTIONS --type-in-type #-}
module Rosetta.Setoids where
open import Rosetta.CartesianClosed
open import Rosetta.Category
open import Rosetta.Equivalence
open import Rosetta.Prelude
open import Rosetta.Sets

record ğ“¢ğ“®ğ“½âˆ£_âŸ¶_ (ğ‘¨ ğ‘© : Setoid) : Set where
  infixr 6 _$_
  field
    _$_   : âˆ£ ğ‘¨ âˆ£ â†’ âˆ£ ğ‘© âˆ£
    .ğ’„ğ’ğ’ğ’ˆ : âˆ€ {x y} â†’ ğ‘¨ âˆ£ x âˆ¼ y â†’ ğ‘© âˆ£ _$_ x âˆ¼ _$_ y

open ğ“¢ğ“®ğ“½âˆ£_âŸ¶_ public

instance
  ğ“¢ğ“®ğ“½âˆ£op : Op ğ“¢ğ“®ğ“½âˆ£_âŸ¶_
  ğ“¢ğ“®ğ“½âˆ£op = record
    { id  = record
      { _$_  = id
      ; ğ’„ğ’ğ’ğ’ˆ = id
      }
    ; _âˆ˜_ = Î» ğ’ˆ ğ’‡ â†’ record
      { _$_  = ğ’ˆ $_   âˆ˜ ğ’‡ $_
      ; ğ’„ğ’ğ’ğ’ˆ = ğ’„ğ’ğ’ğ’ˆ ğ’ˆ âˆ˜ ğ’„ğ’ğ’ğ’ˆ ğ’‡
      }
    }

module _ {ğ‘¨ ğ‘© : Setoid} where
  infix 4 ğ“¢ğ“®ğ“½âˆ£_âˆ¼_
  ğ“¢ğ“®ğ“½âˆ£_âˆ¼_ : Rel (ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©)
  ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’ˆ = âˆ€ {x y}
    â†’ ğ‘¨ âˆ£ x âˆ¼ y
    â†’ ğ‘© âˆ£ ğ’‡ $ x âˆ¼ ğ’ˆ $ y

  .ğ“¢ğ“®ğ“½âˆ£âˆ¼-refl  : âˆ€ {ğ’‡ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©} â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’‡
  .ğ“¢ğ“®ğ“½âˆ£âˆ¼-sym   : âˆ€ {ğ’‡ ğ’ˆ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©} â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’ˆ â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’ˆ âˆ¼ ğ’‡
  .ğ“¢ğ“®ğ“½âˆ£âˆ¼-trans : âˆ€ {ğ’‡ ğ’ˆ ğ’‰ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©} â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’ˆ â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’ˆ âˆ¼ ğ’‰ â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’‰
  ğ“¢ğ“®ğ“½âˆ£âˆ¼-refl  {ğ’‡}     = Î» xâˆ¼y â†’ ğ’„ğ’ğ’ğ’ˆ ğ’‡ xâˆ¼y
  ğ“¢ğ“®ğ“½âˆ£âˆ¼-sym   ğ’‡âˆ¼ğ’ˆ     = Î» xâˆ¼y â†’ sym   (ğ’‡âˆ¼ğ’ˆ (sym xâˆ¼y))
  ğ“¢ğ“®ğ“½âˆ£âˆ¼-trans ğ’‡âˆ¼ğ’ˆ ğ’ˆâˆ¼ğ’‰ = Î» xâˆ¼y â†’ trans (ğ’‡âˆ¼ğ’ˆ xâˆ¼y) (ğ’ˆâˆ¼ğ’‰ refl)

  instance
    ğ“¢ğ“®ğ“½âˆ£âˆ¼-equiv : IsEquivalence ğ“¢ğ“®ğ“½âˆ£_âˆ¼_
    ğ“¢ğ“®ğ“½âˆ£âˆ¼-equiv = record
      { refl  = Î» {ğ’‡}     â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼-refl  {ğ’‡}
      ; sym   = Î» {ğ’‡ ğ’ˆ}   â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼-sym   {ğ’‡} {ğ’ˆ}
      ; trans = Î» {ğ’‡ ğ’ˆ ğ’‰} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼-trans {ğ’‡} {ğ’ˆ} {ğ’‰}
      }

  .ğ“¢ğ“®ğ“½âˆ£âˆ¼-reflâ‚_â‚ : âˆ€ (ğ’‡ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©) â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’‡
  ğ“¢ğ“®ğ“½âˆ£âˆ¼-reflâ‚ ğ’‡ â‚ = ğ“¢ğ“®ğ“½âˆ£âˆ¼-refl {ğ’‡}

ğ“¢ğ“®ğ“½ : Category
ğ“¢ğ“®ğ“½ = record
  { ob = Setoid
  ; _âˆ£_âŸ¶_ = ğ“¢ğ“®ğ“½âˆ£_âŸ¶_
  ; _âˆ£_âˆ¼_ = ğ“¢ğ“®ğ“½âˆ£_âˆ¼_
  ; âˆ˜-congâ‚‚ = Î» ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ ğ’‡â‚âˆ¼ğ’‡â‚‚ xâˆ¼y â†’ ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ (ğ’‡â‚âˆ¼ğ’‡â‚‚ xâˆ¼y)
  ; âˆ˜-unitË¡ = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼-reflâ‚ ğ’‡ â‚ }
  ; âˆ˜-unitÊ³ = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼-reflâ‚ ğ’‡ â‚ }
  ; âˆ˜-assoc = Î» { {f = ğ’‡} {ğ’ˆ} {ğ’‰} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼-reflâ‚ ğ’‰ âˆ˜ ğ’ˆ âˆ˜ ğ’‡ â‚ }
  }

{-# DISPLAY ğ“¢ğ“®ğ“½âˆ£_âŸ¶_ ğ‘¨ ğ‘© = ğ“¢ğ“®ğ“½ âˆ£ ğ‘¨ âŸ¶ ğ‘© #-}
{-# DISPLAY ğ“¢ğ“®ğ“½âˆ£_âˆ¼_ ğ’‡ ğ’ˆ = ğ“¢ğ“®ğ“½ âˆ£ ğ’‡ âˆ¼ ğ’ˆ #-}

module ğ“¢ğ“®ğ“½ where
  infixr 6 _Ã—_
  infixr 7 _â‡’_

  ğŸ™ : Setoid
  ğŸ™ = record
    { âˆ£_âˆ£   = ğ“¢et.ğŸ™
    ; _âˆ£_âˆ¼_ = Î» _ _ â†’ ğ“¢et.ğŸ™
    ; âˆ¼-equiv = record
      { refl  =         tt
      ; sym   = Î» _   â†’ tt
      ; trans = Î» _ _ â†’ tt
      }
    }

  _Ã—_ : Setoid â†’ Setoid â†’ Setoid
  ğ‘¨ Ã— ğ‘© = record
    { âˆ£_âˆ£   = âˆ£ ğ‘¨ âˆ£ ğ“¢et.Ã— âˆ£ ğ‘© âˆ£
    ; _âˆ£_âˆ¼_ = Î» { (xâ‚ , xâ‚‚) (yâ‚ , yâ‚‚) â†’ (ğ‘¨ âˆ£ xâ‚ âˆ¼ yâ‚) ğ“¢et.Ã— (ğ‘© âˆ£ xâ‚‚ âˆ¼ yâ‚‚) }
    ; âˆ¼-equiv = record
      { refl  = refl , refl
      ; sym   = Î» { (xâ‚âˆ¼yâ‚ , xâ‚‚âˆ¼yâ‚‚) â†’ sym xâ‚âˆ¼yâ‚ , sym xâ‚‚âˆ¼yâ‚‚ }
      ; trans = Î» { (xâ‚âˆ¼yâ‚ , xâ‚‚âˆ¼yâ‚‚) (yâ‚âˆ¼zâ‚ , yâ‚‚âˆ¼zâ‚‚) â†’ trans xâ‚âˆ¼yâ‚ yâ‚âˆ¼zâ‚ , trans xâ‚‚âˆ¼yâ‚‚ yâ‚‚âˆ¼zâ‚‚ }
      }
    }

  _â‡’_ : Setoid â†’ Setoid â†’ Setoid
  ğ‘¨ â‡’ ğ‘© = record
    { âˆ£_âˆ£   = ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©
    ; _âˆ£_âˆ¼_ = ğ“¢ğ“®ğ“½âˆ£_âˆ¼_
    }

open ğ“¢ğ“®ğ“½

instance
  ğ“¢ğ“®ğ“½âˆ£opâœ“ : Opâœ“ ğ“¢ğ“®ğ“½âˆ£_âŸ¶_
  ğ“¢ğ“®ğ“½âˆ£opâœ“ = record
    { ğŸ™   = ğŸ™
    ; _Ã—_ = _Ã—_
    ; _â‡’_ = _â‡’_
    ; !     = record
      { _$_  = !
      ; ğ’„ğ’ğ’ğ’ˆ = !
      }
    ; Ï€â‚    = record
      { _$_  = Ï€â‚
      ; ğ’„ğ’ğ’ğ’ˆ = Ï€â‚
      }
    ; Ï€â‚‚    = record
      { _$_  = Ï€â‚‚
      ; ğ’„ğ’ğ’ğ’ˆ = Ï€â‚‚
      }
    ; âŸ¨_,_âŸ© = Î» ğ’‡ ğ’ˆ â†’ record
      { _$_  = âŸ¨ ğ’‡ $_   , ğ’ˆ $_ âŸ©
      ; ğ’„ğ’ğ’ğ’ˆ = âŸ¨ ğ’„ğ’ğ’ğ’ˆ ğ’‡ , ğ’„ğ’ğ’ğ’ˆ ğ’ˆ âŸ©
      }
    ; Îµ     = record
      { _$_  = Î» { (ğ’‡     , x)     â†’ ğ’‡ $   x }
      ; ğ’„ğ’ğ’ğ’ˆ = Î» { (ğ’‡â‚âˆ¼ğ’‡â‚‚ , xâ‚âˆ¼xâ‚‚) â†’ ğ’‡â‚âˆ¼ğ’‡â‚‚ xâ‚âˆ¼xâ‚‚ }
      }
    ; Æ›_    = Î» ğ’‡ â†’ record
      { _$_  = Î» x â†’ record
        { _$_  = Î» y     â†’ ğ’‡ $ (x , y)
        ; ğ’„ğ’ğ’ğ’ˆ = Î» yâ‚âˆ¼yâ‚‚ â†’ ğ’„ğ’ğ’ğ’ˆ ğ’‡ (reflâ‚ x â‚ , yâ‚âˆ¼yâ‚‚)
        }
      ; ğ’„ğ’ğ’ğ’ˆ = Î» xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ ğ’„ğ’ğ’ğ’ˆ ğ’‡ (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
      }
    }

ğ“¢ğ“®ğ“½âœ“ : CartesianClosed ğ“¢ğ“®ğ“½
ğ“¢ğ“®ğ“½âœ“ =
  let open CategoryReasoning ğ“¢ğ“®ğ“½
  in record
  { !-universal   = Î» { {â‡ = â‡} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼-reflâ‚ â‡ â‚ }
  ; âŸ¨,âŸ©-congâ‚‚     = Î» ğ’‡â‚âˆ¼ğ’‡â‚‚ ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ xâˆ¼y â†’ ğ’‡â‚âˆ¼ğ’‡â‚‚ xâˆ¼y , ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ xâˆ¼y
  ; âŸ¨,âŸ©-commuteâ‚  = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼-reflâ‚ ğ’‡ â‚ }
  ; âŸ¨,âŸ©-commuteâ‚‚  = Î» { {g = ğ’ˆ} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼-reflâ‚ ğ’ˆ â‚ }
  ; âŸ¨,âŸ©-universal = Î» â‡-commuteâ‚ â‡-commuteâ‚‚ xâˆ¼y â†’ â‡-commuteâ‚ xâˆ¼y , â‡-commuteâ‚‚ xâˆ¼y
  ; Æ›-cong        = Î» ğ’‡â‚âˆ¼ğ’‡â‚‚ xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ ğ’‡â‚âˆ¼ğ’‡â‚‚ (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
  ; Æ›-commute     = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼-reflâ‚ ğ’‡ â‚ }
  ; Æ›-universal   = Î» â‡-commute xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ â‡-commute (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
  }
