{-# OPTIONS --type-in-type #-}
module Rosetta.Categories where
open import Rosetta.CartesianClosed
open import Rosetta.Category
open import Rosetta.Equality
open import Rosetta.Equivalence
open import Rosetta.Functor
open import Rosetta.Functors
open import Rosetta.NaturalTransformation
open import Rosetta.Prelude
open import Rosetta.Sets
import Rosetta.DiagrammaticReasoning as DiagrammaticReasoning

instance
  ğ“’ğ“ªğ“½-op : Op _âŸ¶_
  ğ“’ğ“ªğ“½-op =
    let open EqReasoning

        id : âˆ€ {ğ“’} â†’ ğ“’ âŸ¶ ğ“’
        id = record
          { _â‚€_ = id
          ; _â‚_ = id
          ; _â‚‚_ = id
          ; resp-âˆ˜â‚€ = refl
          ; resp-âˆ˜â‚‚ = refl
          }

        _âˆ˜_ : âˆ€ {ğ“’ ğ““ ğ“”} â†’ ğ““ âŸ¶ ğ“” â†’ ğ“’ âŸ¶ ğ““ â†’ ğ“’ âŸ¶ ğ“”
        _âˆ˜_ {ğ“’} ğ“– ğ“• = record
          { _â‚€_ = ğ“– â‚€_ âˆ˜ ğ“• â‚€_
          ; _â‚_ = ğ“– â‚_ âˆ˜ ğ“• â‚_
          ; _â‚‚_ = ğ“– â‚‚_ âˆ˜ ğ“• â‚‚_
          ; resp-âˆ˜â‚€ = Î» {A} â†’ begin
            ğ“– â‚ ğ“• â‚ idâ‚ A â‚  â†“âŸ¨ ğ“– â‚‚ (resp-âˆ˜â‚€ ğ“•) âŸ©
            ğ“– â‚ idâ‚ ğ“• â‚€ A â‚  â†“âŸ¨ resp-âˆ˜â‚€ ğ“– âŸ©
            idâ‚ ğ“– â‚€ ğ“• â‚€ A â‚  âˆ
          ; resp-âˆ˜â‚‚ = Î» {A B C}
                        {f : ğ“’ âˆ£ A âŸ¶ B}
                        {g : ğ“’ âˆ£ B âŸ¶ C}
                        â†’ begin
            ğ“– â‚ ğ“• â‚ (g âˆ˜ f)        â†“âŸ¨ ğ“– â‚‚ (resp-âˆ˜â‚‚ ğ“•) âŸ©
            ğ“– â‚ (ğ“• â‚ g âˆ˜ ğ“• â‚ f)    â†“âŸ¨ resp-âˆ˜â‚‚ ğ“– âŸ©
            ğ“– â‚ ğ“• â‚ g âˆ˜ ğ“– â‚ ğ“• â‚ f  âˆ
          }
    in record
      { id  = id
      ; _âˆ˜_ = _âˆ˜_
      }

module _ {ğ“’ ğ““} where
  record ğ“’ğ“ªğ“½âˆ£_â‰ˆ_ (ğ“• ğ“– : ğ“’ âŸ¶ ğ““) : Set where
    constructor _,_
    field
      ğ“•â‚€â‰¡ğ“–â‚€ : ğ“• â‚€_ â‰¡ ğ“– â‚€_
      ğ“•â‚â‰ˆğ“–â‚ : âˆ€ {A B} {f g : ğ“’ âˆ£ A âŸ¶ B}
        â†’ ğ“’ âˆ£ f â‰ˆ g
        â†’ ğ““ âˆ£ transport (Î» ğ“•â‚€ â†’ ğ““ âˆ£ ğ“•â‚€ A âŸ¶ ğ“•â‚€ B) ğ“•â‚€â‰¡ğ“–â‚€ (ğ“• â‚ f) â‰ˆ ğ“– â‚ g

  .ğ“’ğ“ªğ“½â‰ˆ-refl  : âˆ€ {ğ“•} â†’ ğ“’ğ“ªğ“½âˆ£ ğ“• â‰ˆ ğ“•
  .ğ“’ğ“ªğ“½â‰ˆ-sym   : âˆ€ {ğ“• ğ“–} â†’ ğ“’ğ“ªğ“½âˆ£ ğ“• â‰ˆ ğ“– â†’ ğ“’ğ“ªğ“½âˆ£ ğ“– â‰ˆ ğ“•
  .ğ“’ğ“ªğ“½â‰ˆ-trans : âˆ€ {ğ“• ğ“– ğ“—} â†’ ğ“’ğ“ªğ“½âˆ£ ğ“• â‰ˆ ğ“– â†’ ğ“’ğ“ªğ“½âˆ£ ğ“– â‰ˆ ğ“— â†’ ğ“’ğ“ªğ“½âˆ£ ğ“• â‰ˆ ğ“—
  ğ“’ğ“ªğ“½â‰ˆ-refl  {ğ“•}                               = â‰¡-refl , Î» fâ‰ˆg â†’ ğ“• â‚‚ fâ‰ˆg
  ğ“’ğ“ªğ“½â‰ˆ-sym   (â‰¡-refl , ğ“•â‚â‰ˆğ“–â‚)                  = â‰¡-refl , Î» fâ‰ˆg â†’ sym (ğ“•â‚â‰ˆğ“–â‚ (sym fâ‰ˆg))
  ğ“’ğ“ªğ“½â‰ˆ-trans (â‰¡-refl , ğ“•â‚â‰ˆğ“–â‚) (â‰¡-refl , ğ“–â‚â‰ˆğ“—â‚) = â‰¡-refl , Î» fâ‰ˆg â†’ trans (ğ“•â‚â‰ˆğ“–â‚ fâ‰ˆg) (ğ“–â‚â‰ˆğ“—â‚ refl)

  instance
    ğ“’ğ“ªğ“½â‰ˆ-equiv : IsEquivalence ğ“’ğ“ªğ“½âˆ£_â‰ˆ_
    ğ“’ğ“ªğ“½â‰ˆ-equiv = record
      { refl  = ğ“’ğ“ªğ“½â‰ˆ-refl
      ; sym   = ğ“’ğ“ªğ“½â‰ˆ-sym
      ; trans = ğ“’ğ“ªğ“½â‰ˆ-trans
      }

ğ“’ğ“ªğ“½ : Category
ğ“’ğ“ªğ“½ = record
  { ob  = Category
  ; hom = Functor
  ; _â‰ˆ_ = ğ“’ğ“ªğ“½âˆ£_â‰ˆ_
  ; âˆ˜-congâ‚‚ = Î» { (â‰¡-refl , ğ“–â‚â‰ˆğ“–â€²â‚) (â‰¡-refl , ğ“•â‚â‰ˆğ“•â€²â‚) â†’ â‰¡-refl , Î» fâ‰ˆfâ€² â†’ ğ“–â‚â‰ˆğ“–â€²â‚ (ğ“•â‚â‰ˆğ“•â€²â‚ fâ‰ˆfâ€²) }
  ; âˆ˜-unitË¡ = refl
  ; âˆ˜-unitÊ³ = refl
  ; âˆ˜-assoc = refl
  }

{-# DISPLAY ğ“’ğ“ªğ“½âˆ£_â‰ˆ_ ğ“• ğ“– = ğ“’ğ“ªğ“½ âˆ£ ğ“• â‰ˆ ğ“– #-}

module ğ“’ğ“ªğ“½ where
  infixr 6 _Ã—_
  infixr 7 _â‡’_

  ğŸ™ : Category
  ğŸ™ = record
    { ob  = ğ“¢et.ğŸ™
    ; hom = Î» _ _ â†’ ğ“¢et.ğŸ™
    ; _â‰ˆ_ = Î» _ _ â†’ ğ“¢et.ğŸ™
    ; op  = record
      { id  =         tt
      ; _âˆ˜_ = Î» _ _ â†’ tt
      }
    ; â‰ˆ-equiv = record
      { refl  =         tt
      ; sym   = Î» _   â†’ tt
      ; trans = Î» _ _ â†’ tt
      }
    ; âˆ˜-congâ‚‚ = Î» _ _ â†’ tt
    ; âˆ˜-unitË¡ = tt
    ; âˆ˜-unitÊ³ = tt
    ; âˆ˜-assoc = tt
    }

  _Ã—_ : Category â†’ Category â†’ Category
  ğ“’ Ã— ğ““ = record
    { ob  = ob ğ“’ ğ“¢et.Ã— ob ğ““
    ; hom = Î» { (Aâ‚ , Aâ‚‚) (Bâ‚ , Bâ‚‚) â†’ (ğ“’ âˆ£ Aâ‚ âŸ¶ Bâ‚) ğ“¢et.Ã— (ğ““ âˆ£ Aâ‚‚ âŸ¶ Bâ‚‚) }
    ; _â‰ˆ_ = Î» { (fâ‚ , fâ‚‚) (gâ‚ , gâ‚‚) â†’ (ğ“’ âˆ£ fâ‚ â‰ˆ gâ‚) ğ“¢et.Ã— (ğ““ âˆ£ fâ‚‚ â‰ˆ gâ‚‚) }
    ; op  = record
      { id  = id , id
      ; _âˆ˜_ = Î» { (gâ‚ , gâ‚‚) (fâ‚ , fâ‚‚) â†’ gâ‚ âˆ˜ fâ‚ , gâ‚‚ âˆ˜ fâ‚‚ } }
    ; â‰ˆ-equiv = record
      { refl  = refl , refl
      ; sym   = Î» { (fâ‚â‰ˆgâ‚ , fâ‚‚â‰ˆgâ‚‚) â†’ sym fâ‚â‰ˆgâ‚ , sym fâ‚‚â‰ˆgâ‚‚ }
      ; trans = Î» { (fâ‚â‰ˆgâ‚ , fâ‚‚â‰ˆgâ‚‚) (gâ‚â‰ˆhâ‚ , gâ‚‚â‰ˆhâ‚‚) â†’ trans fâ‚â‰ˆgâ‚ gâ‚â‰ˆhâ‚ , trans fâ‚‚â‰ˆgâ‚‚ gâ‚‚â‰ˆhâ‚‚ }
      }
    ; âˆ˜-congâ‚‚ = Î» { (gâ‚â‰ˆgâ‚‚ , gâ‚â€²â‰ˆgâ‚‚â€²) (fâ‚â‰ˆfâ‚‚ , fâ‚â€²â‰ˆfâ‚‚â€²) â†’ âˆ˜-congâ‚‚ ğ“’ gâ‚â‰ˆgâ‚‚ fâ‚â‰ˆfâ‚‚ , âˆ˜-congâ‚‚ ğ““ gâ‚â€²â‰ˆgâ‚‚â€² fâ‚â€²â‰ˆfâ‚‚â€² }
    ; âˆ˜-unitË¡ = âˆ˜-unitË¡ ğ“’ , âˆ˜-unitË¡ ğ““
    ; âˆ˜-unitÊ³ = âˆ˜-unitÊ³ ğ“’ , âˆ˜-unitÊ³ ğ““
    ; âˆ˜-assoc = âˆ˜-assoc ğ“’ , âˆ˜-assoc ğ““
    }

  _â‡’_ = [_,_]

open ğ“’ğ“ªğ“½

instance
  ğ“’ğ“ªğ“½-opâœ“ : Opâœ“ _âŸ¶_
  ğ“’ğ“ªğ“½-opâœ“ =
    let ! : âˆ€ {ğ“§} â†’ ğ“§ âŸ¶ ğŸ™
        ! = record
          { _â‚€_ = !
          ; _â‚_ = !
          ; _â‚‚_ = !
          ; resp-âˆ˜â‚€ = tt
          ; resp-âˆ˜â‚‚ = tt
          }

        Ï€â‚ : âˆ€ {ğ“’ ğ““} â†’ ğ“’ Ã— ğ““ âŸ¶ ğ“’
        Ï€â‚ = record
          { _â‚€_ = Ï€â‚
          ; _â‚_ = Ï€â‚
          ; _â‚‚_ = Ï€â‚
          ; resp-âˆ˜â‚€ = refl
          ; resp-âˆ˜â‚‚ = refl
          }

        Ï€â‚‚ : âˆ€ {ğ“’ ğ““} â†’ ğ“’ Ã— ğ““ âŸ¶ ğ““
        Ï€â‚‚ = record
          { _â‚€_ = Ï€â‚‚
          ; _â‚_ = Ï€â‚‚
          ; _â‚‚_ = Ï€â‚‚
          ; resp-âˆ˜â‚€ = refl
          ; resp-âˆ˜â‚‚ = refl
          }

        âŸ¨_,_âŸ© : âˆ€ {ğ“’ ğ““ ğ“§} â†’ ğ“§ âŸ¶ ğ“’ â†’ ğ“§ âŸ¶ ğ““ â†’ ğ“§ âŸ¶ ğ“’ Ã— ğ““
        âŸ¨ ğ“• , ğ“– âŸ© = record
          { _â‚€_ = âŸ¨ ğ“• â‚€_ , ğ“– â‚€_ âŸ©
          ; _â‚_ = âŸ¨ ğ“• â‚_ , ğ“– â‚_ âŸ©
          ; _â‚‚_ = âŸ¨ ğ“• â‚‚_ , ğ“– â‚‚_ âŸ©
          ; resp-âˆ˜â‚€ = resp-âˆ˜â‚€ ğ“• , resp-âˆ˜â‚€ ğ“–
          ; resp-âˆ˜â‚‚ = resp-âˆ˜â‚‚ ğ“• , resp-âˆ˜â‚‚ ğ“–
          }

        Îµ : âˆ€ {ğ“’ ğ““} â†’ [ ğ“’ , ğ““ ] Ã— ğ“’ âŸ¶ ğ““
        Îµ {ğ“’} {ğ““} =
          let open DiagrammaticReasoning ğ““
          in record
          { _â‚€_ = Î» { (ğ“• , A) â†’ ğ“• â‚€ A }
          ; _â‚_ = Î» { {ğ“• , A} {ğ“– , B} (Î± , f) â†’ Î± â‚ B â‚ âˆ˜ ğ“• â‚ f }
          ; _â‚‚_ = Î» { {ğ“• , A} {ğ“– , B} {Î± , f} {Î±â€² , fâ€²} (Î±â‰ˆÎ±â€² , fâ‰ˆfâ€²) â†’ âˆ˜-congâ‚‚ ğ““ (Î±â‰ˆÎ±â€² B) (ğ“• â‚‚ fâ‰ˆfâ€²) }
          ; resp-âˆ˜â‚€ = Î» { {ğ“• , A} â†’ begin
            id âˆ˜ ğ“• â‚ id  â†“âŸ¨ refl âŸ©âˆ˜âŸ¨ resp-âˆ˜â‚€ ğ“• âŸ©
            id âˆ˜ id      â†“âŸ¨ âˆ˜-unitË¡ ğ““ âŸ©
            id           âˆ }
          ; resp-âˆ˜â‚‚ = Î» { {ğ“• , A} {ğ“– , B} {ğ“— , C}
                          {Î± , f} -- Î± : ğ“ğ“ªğ“½ âˆ£ ğ“• âŸ¶ ğ“–
                                  -- f : ğ“’   âˆ£ A âŸ¶ B
                          {Î² , g} -- Î² : ğ“ğ“ªğ“½ âˆ£ ğ“– âŸ¶ ğ“—
                                  -- g : ğ“’   âˆ£ B âŸ¶ C
                          â†’ begin
            (Î² â‹† Î±) â‚ C â‚ âˆ˜ ğ“• â‚ (g âˆ˜ f)            â†“âŸ¨ refl âŸ©âˆ˜âŸ¨ resp-âˆ˜â‚‚ ğ“• âŸ©
            (Î² â‚ C â‚ âˆ˜ Î± â‚ C â‚) âˆ˜ (ğ“• â‚ g âˆ˜ ğ“• â‚ f)  â†“âŸ¨ âˆ˜-assoc ğ““ âŸ©
            Î² â‚ C â‚ âˆ˜ (Î± â‚ C â‚ âˆ˜ (ğ“• â‚ g âˆ˜ ğ“• â‚ f))  â†‘âŸ¨ refl âŸ©âˆ˜âŸ¨ âˆ˜-assoc ğ““ âŸ©
            Î² â‚ C â‚ âˆ˜ ((Î± â‚ C â‚ âˆ˜ ğ“• â‚ g) âˆ˜ ğ“• â‚ f)  â†“âŸ¨ refl âŸ©âˆ˜âŸ¨ natural Î± âŸ©âˆ˜âŸ¨ refl âŸ©
            Î² â‚ C â‚ âˆ˜ ((ğ“– â‚ g âˆ˜ Î± â‚ B â‚) âˆ˜ ğ“• â‚ f)  â†“âŸ¨ refl âŸ©âˆ˜âŸ¨ âˆ˜-assoc ğ““ âŸ©
            Î² â‚ C â‚ âˆ˜ (ğ“– â‚ g âˆ˜ (Î± â‚ B â‚ âˆ˜ ğ“• â‚ f))  â†‘âŸ¨ âˆ˜-assoc ğ““ âŸ©
            (Î² â‚ C â‚ âˆ˜ ğ“– â‚ g) âˆ˜ (Î± â‚ B â‚ âˆ˜ ğ“• â‚ f)  âˆ }
          }

        Æ›_ : âˆ€ {ğ“’ ğ““ ğ“§} â†’ ğ“§ Ã— ğ“’ âŸ¶ ğ““ â†’ ğ“§ âŸ¶ [ ğ“’ , ğ““ ]
        Æ›_ {ğ“’} {ğ““} {ğ“§} ğ“• =
          let open DiagrammaticReasoning
          in record
          { _â‚€_ = Î» A â†’ record
            { _â‚€_ = Î» B â†’ ğ“• â‚€ (A , B)
            ; _â‚_ = Î» {Bâ‚ Bâ‚‚} (b : ğ“’ âˆ£ Bâ‚ âŸ¶ Bâ‚‚) â†’ ğ“• â‚ (idâ‚ A â‚ , b)
            ; _â‚‚_ = Î» {Bâ‚ Bâ‚‚ bâ‚ bâ‚‚} bâ‚â‰ˆbâ‚‚ â†’ ğ“• â‚‚ (reflâ‚ idâ‚ A â‚ â‚ , bâ‚â‰ˆbâ‚‚)
            ; resp-âˆ˜â‚€ = resp-âˆ˜â‚€ ğ“•
            ; resp-âˆ˜â‚‚ = Î» {Bâ‚ Bâ‚‚ Bâ‚ƒ}
                          {bâ‚ : ğ“’ âˆ£ Bâ‚ âŸ¶ Bâ‚‚}
                          {bâ‚‚ : ğ“’ âˆ£ Bâ‚‚ âŸ¶ Bâ‚ƒ}
                          â†’ begin
              ğ“• â‚ (id , bâ‚‚ âˆ˜ bâ‚)             â†‘âŸ¨ ğ“• â‚‚ (âˆ˜-unitË¡ ğ“§ , refl) âŸ©
              ğ“• â‚ (id âˆ˜ id , bâ‚‚ âˆ˜ bâ‚)        â†“âŸ¨ resp-âˆ˜â‚‚ ğ“• âŸ©
              ğ“• â‚ (id , bâ‚‚) âˆ˜ ğ“• â‚ (id , bâ‚)  âˆ
            }
          ; _â‚_ = Î» {Aâ‚ Aâ‚‚} (a : ğ“§ âˆ£ Aâ‚ âŸ¶ Aâ‚‚) â†’ record
            { _â‚_â‚    = Î» B â†’ ğ“• â‚ (a , idâ‚ B â‚)
            ; natural = Î» {Bâ‚ Bâ‚‚}
                          {b : ğ“’ âˆ£ Bâ‚ âŸ¶ Bâ‚‚}
                          â†’ begin
              ğ“• â‚ (a , id) âˆ˜ ğ“• â‚ (id , b)  â†‘âŸ¨ resp-âˆ˜â‚‚ ğ“• âŸ©
              ğ“• â‚ (a âˆ˜ id , id âˆ˜ b)        â†“âŸ¨ ğ“• â‚‚ (â—â†’â–· ğ“§ (âˆ˜-unitÊ³ ğ“§) (âˆ˜-unitË¡ ğ“§) , â—â†’â–· ğ“’ (âˆ˜-unitË¡ ğ“’) (âˆ˜-unitÊ³ ğ“’)) âŸ©
              ğ“• â‚ (id âˆ˜ a , b âˆ˜ id)        â†“âŸ¨ resp-âˆ˜â‚‚ ğ“• âŸ©
              ğ“• â‚ (id , b) âˆ˜ ğ“• â‚ (a , id)  âˆ
            }
          ; _â‚‚_ = Î» {Aâ‚ Aâ‚‚} {aâ‚ aâ‚‚ : ğ“§ âˆ£ Aâ‚ âŸ¶ Aâ‚‚} aâ‚â‰ˆaâ‚‚ B â†’ ğ“• â‚‚ (aâ‚â‰ˆaâ‚‚ , reflâ‚ idâ‚ B â‚ â‚)
          ; resp-âˆ˜â‚€ = Î» A â†’ resp-âˆ˜â‚€ ğ“•
          ; resp-âˆ˜â‚‚ = Î» {Aâ‚ Aâ‚‚ Aâ‚ƒ}
                        {aâ‚ : ğ“§ âˆ£ Aâ‚ âŸ¶ Aâ‚‚}
                        {aâ‚‚ : ğ“§ âˆ£ Aâ‚‚ âŸ¶ Aâ‚ƒ}
                        B â†’ begin
            ğ“• â‚ (aâ‚‚ âˆ˜ aâ‚ , id)             â†‘âŸ¨ ğ“• â‚‚ (refl , âˆ˜-unitÊ³ ğ“’) âŸ©
            ğ“• â‚ (aâ‚‚ âˆ˜ aâ‚ , id âˆ˜ id)        â†“âŸ¨ resp-âˆ˜â‚‚ ğ“• âŸ©
            ğ“• â‚ (aâ‚‚ , id) âˆ˜ ğ“• â‚ (aâ‚ , id)  âˆ
          }
    in record
    { ğŸ™   = ğŸ™
    ; _Ã—_ = _Ã—_
    ; _â‡’_ = _â‡’_
    ; !     = !
    ; Ï€â‚    = Î» {ğ“’ ğ““} â†’ Ï€â‚ {ğ“’} {ğ““}
    ; Ï€â‚‚    = Î» {ğ“’ ğ““} â†’ Ï€â‚‚ {ğ“’} {ğ““}
    ; âŸ¨_,_âŸ© = âŸ¨_,_âŸ©
    ; Îµ     = Îµ
    ; Æ›_    = Æ›_
    }
