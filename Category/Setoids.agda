{-# OPTIONS --type-in-type #-}
module Rosetta.Category.Setoids where
open import Rosetta.Prelude
open import Rosetta.Category.CartesianClosed
open import Rosetta.Category.Core
open import Rosetta.Category.Sets

record ğ“¢ğ“®ğ“½âˆ£_âŸ¶_ (ğ‘¨ ğ‘© : Setoid) : Set where
  infix 6 _$_
  field
    _$_     : âˆ£ ğ‘¨ âˆ£ â†’ âˆ£ ğ‘© âˆ£
    ._cong_ : âˆ€ {x y} â†’ ğ‘¨ âˆ£ x âˆ¼ y â†’ ğ‘© âˆ£ _$_ x âˆ¼ _$_ y

open ğ“¢ğ“®ğ“½âˆ£_âŸ¶_ public

instance
  ğ“¢ğ“®ğ“½âˆ£op : Op ğ“¢ğ“®ğ“½âˆ£_âŸ¶_
  ğ“¢ğ“®ğ“½âˆ£op = record
    { id  = record
      { _$_    = id
      ; _cong_ = id
      }
    ; _âˆ˜_ = Î» ğ’ˆ ğ’‡ â†’ record
      { _$_    = ğ’ˆ $_    âˆ˜ ğ’‡ $_
      ; _cong_ = ğ’ˆ cong_ âˆ˜ ğ’‡ cong_
      }
    }

module _ {ğ‘¨ ğ‘© : Setoid} where
  infix 4 ğ“¢ğ“®ğ“½âˆ£_âˆ¼_
  ğ“¢ğ“®ğ“½âˆ£_âˆ¼_ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘© â†’ ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘© â†’ Set
  ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’ˆ = âˆ€ {x y}
    â†’ ğ‘¨ âˆ£ x âˆ¼ y
    â†’ ğ‘© âˆ£ ğ’‡ $ x âˆ¼ ğ’ˆ $ y

  .ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿refl  : âˆ€ {ğ’‡ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©} â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’‡
  .ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿sym   : âˆ€ {ğ’‡ ğ’ˆ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©} â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’ˆ â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’ˆ âˆ¼ ğ’‡
  .ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿trans : âˆ€ {ğ’‡ ğ’ˆ ğ’‰ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©} â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’ˆ â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’ˆ âˆ¼ ğ’‰ â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’‰
  ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿refl  {ğ’‡}     = Î» xâˆ¼y â†’ ğ’‡ cong xâˆ¼y
  ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿sym   ğ’‡âˆ¼ğ’ˆ     = Î» xâˆ¼y â†’ sym   (ğ’‡âˆ¼ğ’ˆ (sym xâˆ¼y))
  ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿trans ğ’‡âˆ¼ğ’ˆ ğ’ˆâˆ¼ğ’‰ = Î» xâˆ¼y â†’ trans (ğ’‡âˆ¼ğ’ˆ xâˆ¼y) (ğ’ˆâˆ¼ğ’‰ refl)

  instance
    ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿equiv : IsEquivalence ğ“¢ğ“®ğ“½âˆ£_âˆ¼_
    ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿equiv = record
      { refl  = Î» {ğ’‡}     â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿refl  {ğ’‡}
      ; sym   = Î» {ğ’‡ ğ’ˆ}   â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿sym   {ğ’‡} {ğ’ˆ}
      ; trans = Î» {ğ’‡ ğ’ˆ ğ’‰} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿trans {ğ’‡} {ğ’ˆ} {ğ’‰}
      }

  .ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿reflâ‚_â‚ : âˆ€ (ğ’‡ : ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©) â†’ ğ“¢ğ“®ğ“½âˆ£ ğ’‡ âˆ¼ ğ’‡
  ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿reflâ‚ ğ’‡ â‚ = ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿refl {ğ’‡}

ğ“¢ğ“®ğ“½ : Category
ğ“¢ğ“®ğ“½ = record
  { ob    = Setoid
  ; hom   = ğ“¢ğ“®ğ“½âˆ£_âŸ¶_
  ; _âˆ£_âˆ¼_ = ğ“¢ğ“®ğ“½âˆ£_âˆ¼_
  ; âˆ˜-congâ‚‚ = Î» ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ ğ’‡â‚âˆ¼ğ’‡â‚‚ xâˆ¼y â†’ ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ (ğ’‡â‚âˆ¼ğ’‡â‚‚ xâˆ¼y)
  ; âˆ˜-unitË¡ = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿reflâ‚ ğ’‡ â‚ }
  ; âˆ˜-unitÊ³ = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿reflâ‚ ğ’‡ â‚ }
  ; âˆ˜-assoc = Î» { {f = ğ’‡} {ğ’ˆ} {ğ’‰} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿reflâ‚ ğ’‰ âˆ˜ ğ’ˆ âˆ˜ ğ’‡ â‚ }
  }

{-# DISPLAY ğ“¢ğ“®ğ“½âˆ£_âŸ¶_ ğ‘¨ ğ‘© = ğ“¢ğ“®ğ“½ âˆ£ ğ‘¨ âŸ¶ ğ‘© #-}
{-# DISPLAY ğ“¢ğ“®ğ“½âˆ£_âˆ¼_ ğ’‡ ğ’ˆ = ğ“¢ğ“®ğ“½ âˆ£ ğ’‡ âˆ¼ ğ’ˆ #-}

module ğ“¢ğ“®ğ“½ where
  infixr 6 _Ã—_
  infixl 7 _^_

  ğŸ™ : Setoid
  ğŸ™ = record
    { âˆ£_âˆ£   = ğ“¢et.ğŸ™
    ; _âˆ£_âˆ¼_ = Î» _ _ â†’ ğ“¢et.ğŸ™
    ; âˆ¼â€¿equiv = record
      { refl  =         tt
      ; sym   = Î» _   â†’ tt
      ; trans = Î» _ _ â†’ tt
      }
    }

  _Ã—_ : Setoid â†’ Setoid â†’ Setoid
  ğ‘¨ Ã— ğ‘© = record
    { âˆ£_âˆ£   = âˆ£ ğ‘¨ âˆ£ ğ“¢et.Ã— âˆ£ ğ‘© âˆ£
    ; _âˆ£_âˆ¼_ = Î» { (xâ‚ , xâ‚‚) (yâ‚ , yâ‚‚) â†’ (ğ‘¨ âˆ£ xâ‚ âˆ¼ yâ‚) ğ“¢et.Ã— (ğ‘© âˆ£ xâ‚‚ âˆ¼ yâ‚‚) }
    ; âˆ¼â€¿equiv = record
      { refl  = refl , refl
      ; sym   = Î» { (xâ‚âˆ¼yâ‚ , xâ‚‚âˆ¼yâ‚‚) â†’ sym xâ‚âˆ¼yâ‚ , sym xâ‚‚âˆ¼yâ‚‚ }
      ; trans = Î» { (xâ‚âˆ¼yâ‚ , xâ‚‚âˆ¼yâ‚‚) (yâ‚âˆ¼zâ‚ , yâ‚‚âˆ¼zâ‚‚) â†’ trans xâ‚âˆ¼yâ‚ yâ‚âˆ¼zâ‚ , trans xâ‚‚âˆ¼yâ‚‚ yâ‚‚âˆ¼zâ‚‚ }
      }
    }

  _^_ : Setoid â†’ Setoid â†’ Setoid
  ğ‘© ^ ğ‘¨ = record
    { âˆ£_âˆ£   = ğ“¢ğ“®ğ“½âˆ£ ğ‘¨ âŸ¶ ğ‘©
    ; _âˆ£_âˆ¼_ = ğ“¢ğ“®ğ“½âˆ£_âˆ¼_
    }

open ğ“¢ğ“®ğ“½

instance
  ğ“¢ğ“®ğ“½âˆ£opâœ“ : Opâœ“ ğ“¢ğ“®ğ“½âˆ£_âŸ¶_
  ğ“¢ğ“®ğ“½âˆ£opâœ“ = record
    { ğŸ™   = ğŸ™
    ; _Ã—_ = _Ã—_
    ; _^_ = _^_
    ; !     = record
      { _$_    = !
      ; _cong_ = !
      }
    ; Ï€â‚    = record
      { _$_    = Ï€â‚
      ; _cong_ = Ï€â‚
      }
    ; Ï€â‚‚    = record
      { _$_    = Ï€â‚‚
      ; _cong_ = Ï€â‚‚
      }
    ; âŸ¨_,_âŸ© = Î» ğ’‡ ğ’ˆ â†’ record
      { _$_    = âŸ¨ ğ’‡ $_    , ğ’ˆ $_ âŸ©
      ; _cong_ = âŸ¨ ğ’‡ cong_ , ğ’ˆ cong_ âŸ©
      }
    ; Îµ     = record
      { _$_    = Î» { (ğ’‡     , x)     â†’ ğ’‡ $   x }
      ; _cong_ = Î» { (ğ’‡â‚âˆ¼ğ’‡â‚‚ , xâ‚âˆ¼xâ‚‚) â†’ ğ’‡â‚âˆ¼ğ’‡â‚‚ xâ‚âˆ¼xâ‚‚ }
      }
    ; Æ›_    = Î» ğ’‡ â†’ record
      { _$_    = Î» x â†’ record
        { _$_    = Î» y     â†’ ğ’‡ $    (      x   , y)
        ; _cong_ = Î» yâ‚âˆ¼yâ‚‚ â†’ ğ’‡ cong (reflâ‚ x â‚ , yâ‚âˆ¼yâ‚‚)
        }
      ; _cong_ = Î» xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ ğ’‡ cong (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
      }
    }

ğ“¢ğ“®ğ“½âœ“ : CartesianClosed ğ“¢ğ“®ğ“½
ğ“¢ğ“®ğ“½âœ“ =
  let open CategoryReasoning ğ“¢ğ“®ğ“½
  in record
  { !-universal   = Î» { {â‡ = â‡} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿reflâ‚ â‡ â‚ }
  ; âŸ¨,âŸ©-congâ‚‚     = Î» ğ’‡â‚âˆ¼ğ’‡â‚‚ ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ xâˆ¼y â†’ ğ’‡â‚âˆ¼ğ’‡â‚‚ xâˆ¼y , ğ’ˆâ‚âˆ¼ğ’ˆâ‚‚ xâˆ¼y
  ; âŸ¨,âŸ©-commuteâ‚  = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿reflâ‚ ğ’‡ â‚ }
  ; âŸ¨,âŸ©-commuteâ‚‚  = Î» { {g = ğ’ˆ} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿reflâ‚ ğ’ˆ â‚ }
  ; âŸ¨,âŸ©-universal = Î» â‡-commuteâ‚ â‡-commuteâ‚‚ xâˆ¼y â†’ â‡-commuteâ‚ xâˆ¼y , â‡-commuteâ‚‚ xâˆ¼y
  ; Æ›-cong        = Î» ğ’‡â‚âˆ¼ğ’‡â‚‚ xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ ğ’‡â‚âˆ¼ğ’‡â‚‚ (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
  ; Æ›-commute     = Î» { {f = ğ’‡} â†’ ğ“¢ğ“®ğ“½âˆ£âˆ¼â€¿reflâ‚ ğ’‡ â‚ }
  ; Æ›-universal   = Î» â‡-commute xâ‚âˆ¼xâ‚‚ yâ‚âˆ¼yâ‚‚ â†’ â‡-commute (xâ‚âˆ¼xâ‚‚ , yâ‚âˆ¼yâ‚‚)
  }
